[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-27 10:51:58.182906",
  "module": "Karp Communication",
  "name": "Order Ready Script",
  "script": "frappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Ord Ready Msg'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Order Ready'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-27 10:51:50.353461",
  "module": "Karp Communication",
  "name": "Share Invoice",
  "script": "frappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Share Invoice'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Share Invoice'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-27 10:56:08.524319",
  "module": "Karp Communication",
  "name": "Send Thankyou Msg",
  "script": "frappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Send Thankyou Msg'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Thankyou Msg'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-12-27 10:51:43.866706",
  "module": "Karp Communication",
  "name": "Send Thankyou Msg - SI",
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Send Thankyou Msg'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Thankyou Msg'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-12-27 10:51:35.029466",
  "module": "Karp Communication",
  "name": "Share Invoice - SI",
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Share Invoice'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Share Invoice'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-12-27 10:50:58.862370",
  "module": "Karp Communication",
  "name": "Order Ready Script - SI",
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Ord Ready Msg'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Order Ready'\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Eye Camp Lead",
  "enabled": 1,
  "modified": "2024-10-01 19:28:19.544526",
  "module": "Karp Communication",
  "name": "Eye Camp Outreach",
  "script": "frappe.ui.form.on('Eye Camp Lead', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Send Outreach Msg'), function() {\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link_for_eye_camp_marketing',\n                    args: {\n                        id: frm.doc.name\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Actions\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Website Item",
  "enabled": 1,
  "modified": "2025-01-23 11:38:28.432091",
  "module": "Karp Optical",
  "name": "Website Item Script",
  "script": "frappe.ui.form.on('Website Item', {\n    refresh: function(frm) {\n        frm.set_query(\"filters\", function() {\n            return {\n                filters: {\n                    fieldname: [\"in\", [\"custom_gender\", \"other_custom_field\"]]\n                }\n            };\n        });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-27 10:50:39.952780",
  "module": "Karp Communication",
  "name": "Welcome Msg",
  "script": "frappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__('Send Welcome Msg'), function() {\n\t\t    \n\t\t    let customer_name = frm.doc.customer;\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name,\n                        wa_template_name: 'Welcome Msg',\n                        order_id: frm.doc.name\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-12-27 10:55:23.594043",
  "module": "Karp Communication",
  "name": "Open Whatsapp - Cut",
  "script": "frappe.ui.form.on('Customer', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__(' Open Whatsapp'), function() {\n\t\t    let customer_name = frm.doc.name;\n\n            let url;    \n            frappe.call({\n                    method: 'karp_communication.api.whatsapp.get_wa_link',\n                    args: {\n                        customer_name: customer_name\n                    },\n                    callback: function(response) {\n                        if (response.message) {\n                            url = response.message\n                            window.open(url, '_blank');\n                        }\n                    }\n            })  \n            \n\t\t    \n           \n        }, __(\"Communication\"));\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-12-30 20:53:27.936860",
  "module": "Karp Communication",
  "name": "Mark Communication Staus",
  "script": "frappe.ui.form.on('Customer', {\n    refresh(frm) {\n\n        if (!frm.is_new()) {\n\n            frm.add_custom_button(__('Mark Refer Msg Sent'), () => {\n                mark_message_sent(frm, 'refer');\n            }, __('Actions'));\n\n            frm.add_custom_button(__('Mark Ambassador Msg Sent'), () => {\n                mark_message_sent(frm, 'ambassador');\n            }, __('Actions'));\n\n            frm.add_custom_button(__('Mark 6M Test Rmdr'), () => {\n                mark_message_sent(frm, 'six_m_eye_test');\n            }, __('Actions'));\n            \n            frm.add_custom_button(__('Mark 9M Test Rmdr'), () => {\n                mark_message_sent(frm, 'nine_m_eye_test');\n            }, __('Actions'));\n            \n            frm.add_custom_button(__('Mark 12M Test Rmdr'), () => {\n                mark_message_sent(frm, 'twelve_m_eye_test');\n            }, __('Actions'));\n        }\n    }\n});\n\nfunction mark_message_sent(frm, type) {\n\n    let field_map = {\n        refer: 'custom_refer_msg_sent_date',\n        ambassador: 'custom_ambassador_msg_sent_date',\n        six_m_eye_test: 'custom_6m_test_rmdr_date',\n        nine_m_eye_test: 'custom_6m_test_rmdr_date',\n        twelve_m_eye_test: 'custom_12m_test_rmdr_date'\n    };\n\n    let fieldname = field_map[type];\n\n    frappe.confirm(\n        __('Confirm message has been sent on WhatsApp?'),\n        () => {\n            frm.set_value(fieldname, frappe.datetime.get_today());\n            frm.save();\n        }\n    );\n}\n",
  "view": "Form"
 }
]